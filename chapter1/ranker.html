
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Ranking Problem &#8212; RecSys Handbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=4ec06e9971c5264fbd345897d5258098f11cc577" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=8bf782fb4ee92b3d3646425e50f299c4e1fd152d"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1KXERRXYG5"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-1KXERRXYG5');
            </script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter1/ranker';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Full Pipeline of the Two-level Recommender System" href="full_pipeline.html" />
    <link rel="prev" title="Collaborative Filtering" href="collab_filter.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">RecSys Handbook</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="intro_to_rekko.html">
                        Introduction to Recommendation Problem
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="baseline.html">
                        Baseline Implementation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="validation_metrics.html">
                        Metrics & Validation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="content_filter.html">
                        Content-Based Filtering
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="collab_filter.html">
                        Collaborative Filtering
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Ranking Problem in Machine Learning
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="full_pipeline.html">
                        Full Pipeline of the Two-level RecSys
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter2/intro_to_deployment.html">
                        Introduction to Production Code & Deployment
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter2/api_dev.html">
                        API Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter2/docker.html">
                        Containerization with Docker
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter3/intro_to_analytics.html">
                        INTRODUCTION TO PRODUCT ANALYTCS
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="intro_to_rekko.html">
                        Introduction to Recommendation Problem
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="baseline.html">
                        Baseline Implementation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="validation_metrics.html">
                        Metrics & Validation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="content_filter.html">
                        Content-Based Filtering
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="collab_filter.html">
                        Collaborative Filtering
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Ranking Problem in Machine Learning
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="full_pipeline.html">
                        Full Pipeline of the Two-level RecSys
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter2/intro_to_deployment.html">
                        Introduction to Production Code & Deployment
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter2/api_dev.html">
                        API Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter2/docker.html">
                        Containerization with Docker
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter3/intro_to_analytics.html">
                        INTRODUCTION TO PRODUCT ANALYTCS
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item">
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">RecSys Handbook</p>
  
</a>
    </div>
    <div class="sidebar-start-items__item">
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome To The World Of Recommendations and Ranking
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">CHAPTER 1 - OVERVIEW OF RECOMMENDATION SYSTEMS</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro_to_rekko.html">Introduction to Recommendation Problem</a></li>

<li class="toctree-l1"><a class="reference internal" href="baseline.html">Baseline Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="validation_metrics.html">Metrics &amp; Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="content_filter.html">Content-based Filtering in a Nutshell</a></li>

<li class="toctree-l1"><a class="reference internal" href="collab_filter.html">Collaborative Filtering</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Ranking Problem</a></li>


<li class="toctree-l1"><a class="reference internal" href="full_pipeline.html">Full Pipeline of the Two-level Recommender System</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">CHAPTER 2 - PRODUCTION CODE &amp; DEPLOYMENT</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../chapter2/intro_to_deployment.html">What comes after ML model development?</a></li>



<li class="toctree-l1"><a class="reference internal" href="../chapter2/api_dev.html">Application Programming Interface (<code class="docutils literal notranslate"><span class="pre">API</span></code>)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../chapter2/docker.html">Containerization with Docker</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">CHAPTER 3 - Estimation of RecSys and other ML models in real world</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../chapter3/intro_to_analytics.html">INTRODUCTION TO PRODUCT ANALYTCS</a></li>
</ul>

    </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        <label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" data-toggle="tooltip" data-placement="right" title="Toggle primary sidebar">
            <span class="fa-solid fa-bars"></span>
        </label>
    </div>
    <div class="header-article__right">


<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
  </ul>
</div>

<button onclick="toggleFullScreen()"
  class="btn btn-sm"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<div class="dropdown dropdown-repository-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="https://github.com/kshurik/rekko_handbook" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">repository</span>
</a>
</a>
      
      <li><a href="https://github.com/kshurik/rekko_handbook/issues/new?title=Issue%20on%20page%20%2Fchapter1/ranker.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">open issue</span>
</a>
</a>
      
  </ul>
</div>



<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="../_sources/chapter1/ranker.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</a>
      
      <li><a href="../_sources/chapter1/ranker.md" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</a>
      
      <li>
<button onclick="printPdf(this)"
  class="btn btn-sm dropdown-item"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</a>
      
  </ul>
</div>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary" data-toggle="tooltip" data-placement="left" title="Toggle secondary sidebar">
            <span class="fa-solid fa-list"></span>
        </label>
    </div>
</div>
            </div>
            
            

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ranking Problem</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Ranking Problem
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training-learnig-to-rank-models">
   Training learnig-to-rank models
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#source-further-recommendations">
   Source &amp; further recommendations
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>

            <article class="bd-article" role="main">
              
  <section class="tex2jax_ignore mathjax_ignore" id="ranking-problem">
<span id="chapter1-part6"></span><h1>Ranking Problem<a class="headerlink" href="#ranking-problem" title="Permalink to this heading">#</a></h1>
<p>The ranking problem is a type of supervised or semi-supervised learning problem where the goal
is to predict the relative order of a set of items. It is commonly used in search engines,
recommender systems, and other applications where the order of the response is vital. Ranking
models usually try to predict a relevance score and sorting is made based on these scores.
Strictly speaking, <span class="math notranslate nohighlight">\(s = f(x)\)</span>, <span class="math notranslate nohighlight">\(s\)</span> - stands for ranking model and for each
input <span class="math notranslate nohighlight">\(x = (q, d)\)</span> where <span class="math notranslate nohighlight">\(q\)</span> is a query and <span class="math notranslate nohighlight">\(d\)</span> is a document we predict <em>relevance scores</em></p>
<p>Depending on the context and business needs, the prediction of the relevance score can be considered as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Binary</span> <span class="pre">classification</span></code> - whether the user will click on the recommended movie;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Regression</span></code> - prediction of watch time by a user for the particularly recommended movie;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Learning-to-rank</span></code></p></li>
</ul>
<p>Considering that the first two tasks are quite widespread, here we will focus in learning-to-rank
class of models. So, why do we have a distinct class of learning-to-rank models while it is still?
The main difference between learning to rank and classification/regression models is that
classification/regression models predict a label or value for a single input
while learning to rank models predict a ranking for a list of inputs. You have a
list of items and you can make pair comparisons within this set and decide the order within that
set. In the case of regression/classification, you will not be able to do that.</p>
<p><img alt="" src="../_images/ranking_example_1.png" /></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="training-learnig-to-rank-models">
<h1>Training learnig-to-rank models<a class="headerlink" href="#training-learnig-to-rank-models" title="Permalink to this heading">#</a></h1>
<p>In the learning-to-rank pipeline there are three approaches to training the model:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Pointwise</span></code>: basically, it takes a single item from a list and computes loss using
only its information. It resembles the same as if a classifier/regressor is trained;
Some examples: cosine distance between embeddings, logistic regression based on some
features with binary relevance target etc, BM25 (it is an “advanced” version of tf-idf).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Pairwise</span></code>: in this approach, a pair of documents is used to minimize the loss.
The idea is to minimize the number of swaps in the final ordered list. Some of the most
popular methods are <a class="reference external" href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/MSR-TR-2010-82.pdf">RankNet, LambdaRank, and LambdaMART</a>;</p></li>
</ul>
<p>In this approach, there are three main methods to train the model - <code class="docutils literal notranslate"><span class="pre">RankNet</span></code>, <code class="docutils literal notranslate"><span class="pre">LambdaRank</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">LambdaMART</span></code>:</p>
<p><strong>RankNet</strong></p>
<p>This cost function tries to minimize the number of swaps in the final ordered list. Originally,
it was developed for optimization parameters in neural nets, but in general the underlying model
can be set to any. The formula:</p>
<p><span class="math notranslate nohighlight">\(P_{ij} \equiv P(U_{i}&gt;U_{j}) \equiv \frac{1}{1 + \exp^{-\sigma(s_{i} - s{j})}}\)</span></p>
<p>Instead of directly predicting the score of each item one by one, RankNet proposed
to model the target probabilities between any two items. For instance,
take 3 movies: <code class="docutils literal notranslate"><span class="pre">movie</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">movie</span> <span class="pre">2</span></code>, and <code class="docutils literal notranslate"><span class="pre">movie</span> <span class="pre">3</span></code> with scores 0, 5, and 3 respectively.
The 3 distinct combinations give us <code class="docutils literal notranslate"><span class="pre">P(movie</span> <span class="pre">1</span> <span class="pre">&amp;</span> <span class="pre">movie</span> <span class="pre">2)</span> <span class="pre">=</span> <span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">P(movie</span> <span class="pre">1</span> <span class="pre">&amp;</span> <span class="pre">movie</span> <span class="pre">3)</span> <span class="pre">=</span> <span class="pre">0</span></code>
and <code class="docutils literal notranslate"><span class="pre">P(movie</span> <span class="pre">2</span> <span class="pre">&amp;</span> <span class="pre">movie</span> <span class="pre">3)</span> <span class="pre">=</span> <span class="pre">1</span></code> - this is considered as one training sample and the model tries
to model this distribution.</p>
<p><strong>LambdaRank</strong></p>
<p>It was derived after <code class="docutils literal notranslate"><span class="pre">RankNet</span></code>, researchers found that during the process you do not need values of costs,
but only the gradients of the cost w.r.t model score. The formula that explains the idea
with NDCG is the following:</p>
<p><span class="math notranslate nohighlight">\(\lambda_{ij} = \frac{\partial C(s_{i} - s_{j})}{\partial s_{i}} = \frac{-\alpha}{1 + \exp^{\alpha(s_{i} - s_{j})}}|\Delta NDCG|\)</span>,
where C is the cost function, <span class="math notranslate nohighlight">\(\delta NDCG\)</span> stands for how much NDCG will change if swap <em>i</em> and <em>j</em></p>
<p><strong>LambdaMART</strong></p>
<p>This approach combines <code class="docutils literal notranslate"><span class="pre">LambdaRank</span></code> &amp;  <code class="docutils literal notranslate"><span class="pre">Multiple</span> <span class="pre">Additive</span> <span class="pre">Regression</span> <span class="pre">Trees</span> <span class="pre">(MART)</span></code>. The approach is
quite straightforward: we use gradient-boosted trees for prediction tasks and incorporate <code class="docutils literal notranslate"><span class="pre">LambdaRank</span></code>
cost function into the model to convert it to solve a ranking problem. On experimental data, this
method outperformed <code class="docutils literal notranslate"><span class="pre">RankNet</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">LambdaRank</span></code>. However, both the Pointwise and Pairwise methods
fail to determine the impact of the whole group (list of items). Here comes the next method</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Listwise</span></code>: as in the naming, it takes the whole list of candidates at once and tries to rank
documents optimally. For that it uses two approaches:</p></li>
</ul>
<ol class="arabic simple">
<li><p>Direct optimization of information retrieval (IR) metric such as NDCG via approximation
with <a class="reference external" href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/SoftRankWsdm08Submitted.pdf">SoftRank</a> / <a class="reference external" href="https://www.semanticscholar.org/paper/AdaRank%3A-a-boosting-algorithm-for-information-Xu-Li/a489d95fb930401c1f4b7d92bb139d271d49abbf">AdaRank</a>;</p></li>
<li><p>Minimization of the loss that is defined based on your domain knowledge of what you are trying to achieve.
These are ListNet and ListMLE losses.</p></li>
</ol>
<p>There are two methods in the listwise approach - <code class="docutils literal notranslate"><span class="pre">ListNet</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">ListMLE</span></code>. These are the two most popular ones.
In this task, each item has a set of features that describe its properties and relevance to the query.
The goal is to learn a ranking function that maps these features to a ranking order.</p>
<p><strong>ListNet</strong></p>
<p>It is a listwise version of the aforementioned <code class="docutils literal notranslate"><span class="pre">RankNet</span></code>. It uses a cross-entropy loss function along
with gradient descent to optimize parameters for the neural net. In cases when we have only two items
in a list the result of the <code class="docutils literal notranslate"><span class="pre">ListNet</span></code> coincides with <code class="docutils literal notranslate"><span class="pre">RankNet</span></code>. The idea behind ListNet is to learn
a probability distribution over the permutations of the items in the list, such that the more
relevant items appear at the top of the list with higher probability. The training objective
of ListNet is to maximize the likelihood of the ground-truth permutation, which is the permutation
that corresponds to the actual relevance of the items. This is done by minimizing the cross-entropy
loss between the predicted and ground-truth probability distributions.
So, how do we get probabilities in the first place, and how permutations are involved? Let’s go step-by-step.</p>
<p>Let’s assume, we have three movies to rank <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">Godfather,</span> </code>Avatar<code class="docutils literal notranslate"><span class="pre">,</span> <span class="pre">&amp;</span> </code>Ozark`
What are all possible permutations for these three objects?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>

<span class="n">movies_to_rank</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;The Godfather&#39;</span><span class="p">,</span> <span class="s1">&#39;Avatar&#39;</span><span class="p">,</span> <span class="s1">&#39;Ozark&#39;</span><span class="p">}</span>
<span class="n">permutations_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">permutations</span><span class="p">(</span><span class="n">movies_to_rank</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">permutations_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;Avatar&#39;, &#39;The Godfather&#39;, &#39;Ozark&#39;)
(&#39;Avatar&#39;, &#39;Ozark&#39;, &#39;The Godfather&#39;)
(&#39;The Godfather&#39;, &#39;Avatar&#39;, &#39;Ozark&#39;)
(&#39;The Godfather&#39;, &#39;Ozark&#39;, &#39;Avatar&#39;)
(&#39;Ozark&#39;, &#39;Avatar&#39;, &#39;The Godfather&#39;)
(&#39;Ozark&#39;, &#39;The Godfather&#39;, &#39;Avatar&#39;)
</pre></div>
</div>
</div>
</div>
<p>Now, we have all possible permutations for this object, and, say, we predicted some scores that can be
used to rank these objects. Next, we are interested in how we can use these scores to determine
which permutation of all combinations is more relevant than the other. Here is how it proposed in the
<a class="reference external" href="http://times.cs.uiuc.edu/course/598f14/l2r.pdf">paper</a></p>
<p><span class="math notranslate nohighlight">\(P_{s}(\pi) = \prod^n_{j = 1} \frac {\phi(s_{\pi(j)})} {\sum^n_{k = j} \phi(s_{\pi(k)})}\)</span></p>
<p>Wow, that’s a big formula. Let’s break it down:</p>
<ul class="simple">
<li><p>We calculate the probability for a particular permutation <span class="math notranslate nohighlight">\(\pi\)</span> given some predicted scores <span class="math notranslate nohighlight">\(s\)</span>;</p></li>
<li><p>Big <span class="math notranslate nohighlight">\(\prod\)</span> stands for calculation of the product of <span class="math notranslate nohighlight">\(n\)</span> terms (permutations);</p></li>
<li><p>Next, <span class="math notranslate nohighlight">\(\phi\)</span> is a transformation function with a required property - <code class="docutils literal notranslate"><span class="pre">an</span> <span class="pre">increasing</span> <span class="pre">and</span> <span class="pre">strictly</span> <span class="pre">positive</span> <span class="pre">function</span></code>
i.e. the higher predicted score <span class="math notranslate nohighlight">\(s\)</span> the higher value of the function</p></li>
</ul>
<p>Considering our example, we can continue by generating some random scores as our predictions and pick one
of the permutations randomly</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">scores_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">movies_to_rank</span><span class="p">}</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">scores_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Avatar&#39;: 0.4967141530112327, &#39;The Godfather&#39;: -0.13826430117118466, &#39;Ozark&#39;: 0.6476885381006925}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="n">pi</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">permutations_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>

<span class="c1"># unpack pi and assign movies to scores</span>
<span class="n">score_movie_pos_1</span><span class="p">,</span> <span class="n">score_movie_pos_2</span><span class="p">,</span> <span class="n">score_movie_pos_3</span> <span class="o">=</span> <span class="n">scores_dict</span><span class="p">[</span><span class="n">pi</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">scores_dict</span><span class="p">[</span><span class="n">pi</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">scores_dict</span><span class="p">[</span><span class="n">pi</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;Ozark&#39;, &#39;Avatar&#39;, &#39;The Godfather&#39;)
</pre></div>
</div>
</div>
</div>
<p>Now, we can move to use our aforementioned formula using these numbers. There are going to be three
terms with combinrations: The Godfather vs The Godfather  + Avatar + Ozark, Avatar vs Avatar + Ozark
and finally Ozark vs Ozark</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">first_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">score_movie_pos_1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">score_movie_pos_1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">score_movie_pos_2</span><span class="p">)</span>\
                                         <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">score_movie_pos_3</span><span class="p">))</span>

<span class="n">second_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">score_movie_pos_2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">score_movie_pos_2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">score_movie_pos_3</span><span class="p">))</span>

<span class="n">third_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">score_movie_pos_3</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">score_movie_pos_3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;First term is: </span><span class="si">{</span><span class="n">first_term</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Second term is: </span><span class="si">{</span><span class="n">second_term</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Third term is: </span><span class="si">{</span><span class="n">third_term</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First term is: 0.4318619033836114
Second term is: 0.6536174529063914
Third term is: 1.0
</pre></div>
</div>
</div>
</div>
<p>What we have done so far? <span class="math notranslate nohighlight">\(P_{s}(&lt;The Godfather, Avatar, Ozark&gt;) = \prod^3_{j = 1} \frac {\phi(s_{\pi(j)})} {\sum^3_{k = j} \phi(s_{\pi(k)})}\)</span> which is equal to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">permutation_proba</span> <span class="o">=</span> <span class="n">first_term</span> <span class="o">*</span> <span class="n">second_term</span> <span class="o">*</span> <span class="n">third_term</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Permutation probability is: </span><span class="si">{</span><span class="n">permutation_proba</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Permutation probability is: 0.2822724772969022
</pre></div>
</div>
</div>
</div>
<p>In this manner, we can calculate the permutation probability for each set in our list of all permutations.
Thus, the final probabilities will sum up to 1 and we can sort using this probability! Now,
we know how to get probability distributions of permutations. So far, we used some random numbers
to calculate this, but how do we get these scores in real life? To get scores
The neural network model is used. We define any architecture and feed <code class="docutils literal notranslate"><span class="pre">query</span> <span class="pre">-</span> <span class="pre">document</span></code> features
and use cross-entropy / KL-divergence to train the model. Thanks to this <a class="reference external" href="https://embracingtherandom.com/machine-learning/tensorflow/ranking/deep-learning/learning-to-rank-part-2/">source</a>, all further details can be found there.
Finally, it is worth mentioning that calculating all permutations is too computationally expensive
and authors propose the <code class="docutils literal notranslate"><span class="pre">Top</span> <span class="pre">One</span> <span class="pre">Probability</span></code> method to avoid the calculation of all permutations.</p>
<p><strong>ListMLE</strong></p>
<p>ListMLE is another learning-to-rank method that uses a maximum likelihood estimation (MLE)
framework to learn the ranking function. The idea behind ListMLE is to directly model the
likelihood of the ground-truth permutation, rather than the probability distribution.
The training objective of ListMLE is to maximize the log-likelihood of the ground-truth
permutation under the Mallows model. This is done by minimizing the negative log-likelihood,
which is equivalent to minimizing the Kendall tau distance between the predicted
and ground-truth permutations.</p>
<p>A more detailed explanation of these three approaches in learning-to-rank tasks are explained
<a class="reference external" href="http://icml2008.cs.helsinki.fi/papers/167.pdf">here</a>.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="source-further-recommendations">
<h1>Source &amp; further recommendations<a class="headerlink" href="#source-further-recommendations" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="https://catboost.ai/">Catboost Documentation</a></p></li>
<li><p><a class="reference external" href="https://embracingtherandom.com/machine-learning/tensorflow/ranking/deep-learning/learning-to-rank-part-2/">Learning-to-rank explained</a></p></li>
</ul>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapter1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

            </article>
            

            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="collab_filter.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Collaborative Filtering</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="full_pipeline.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Full Pipeline of the Two-level Recommender System</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Ranking Problem
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training-learnig-to-rank-models">
   Training learnig-to-rank models
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#source-further-recommendations">
   Source &amp; further recommendations
  </a>
 </li>
</ul>

</nav>
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Shuhrat Khalilbekov
</p>

  </div>
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
Last updated on None.<br>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </div>
        </footer>
        

      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  </body>
</html>